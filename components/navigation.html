<script>
    (function (ns) {
        let root = null
        let pageElements = {};
        let loader = null

        class Page {
            constructor(id, name, element, pageApp, hide) {
                this.id = id
                this.name = name
                this.element = element
                this.pageApp = pageApp
                this.hide = hide
            }
        }

        function init(
            firstPageId,
            element,
            loaderClass,
            isHidden = false
        ) {
            root = element
            if (isHidden) {
                root.style.display = "none"
            }
            Object.keys(pageElements).forEach(key => {
                let page = pageElements[key]
                if (!page.hide) {
                    const btn = createNavButton(page.name, page.id)
                    root.appendChild(btn)
                }
            })
            root.addEventListener('click', clickHandler)
            loader = loaderClass
            selectPage(firstPageId)
        }

        function clickHandler(event) {
            selectPage(event.target.dataset.action)
        }

        function selectPage(id) {
            if (!pageElements[id]) {
                return
            }
            hideAll()
            destroyAll()
            pageElements[id].element.style.display = "block"
            if (pageElements[id].pageApp) {
                pageElements[id].pageApp.init(loader)
            }
        }

        function add(
            id,
            name,
            element,
            pageApp = null,
            hide = false,
        ) {
            pageElements[id] = new Page(id, name, element, pageApp, hide)
        }

        function hideAll() {
            Object.keys(pageElements).forEach(key => {
                if (pageElements[key]?.element) {
                    pageElements[key].element.style.display = "none"
                }
            })
        }

        function destroyAll() {
            Object.keys(pageElements).forEach(key => {
                if (pageElements[key]?.pageApp) {
                    pageElements[key].pageApp.destroy()
                }
            })
        }

        function createNavButton(name, id) {
            const btn = document.createElement('button')
            btn.setAttribute("data-action", id)
            btn.className = "btn btn-secondary"
            btn.style = "margin-right:5px;"
            btn.innerText = name
            return btn
        }

        function destroy() {
            root.removeEventListener('click', clickHandler)
        }

        ns.Navigation = {
            init,
            add,
            destroy,
        };
    })(window.App = window.App || {});

</script>